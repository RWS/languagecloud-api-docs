<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Testing with Docker </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Testing with Docker ">
    
    
      <link rel="shortcut icon" href="../../../../../favicon.ico">
      <link rel="stylesheet" href="../../../../../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../../../../../styles/docfx.css">
      <link rel="stylesheet" href="../../../../../styles/main.css">
      <meta property="docfx:navrel" content="../../../../../toc.html">
      <meta property="docfx:tocrel" content="../../../toc.html">
    
    <meta property="docfx:rel" content="../../../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>        

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="https://developers.rws.com/">
                <img id="logo" class="svg" src="../../../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>

        <div class="container body-content">

          <div id="search-results">
            <div class="search-list">Search Results for <span></span></div>
            <div class="sr-items">
              <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
            </div>
            <ul id="pagination" data-first=First data-prev=Previous data-next=Next data-last=Last></ul>
          </div>
        </div>

      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="testing-with-docker">Testing with Docker</h1>

<p>This guide is mainly aimed at developers who want to deploy the app within a Docker container. Throughout the guide, we will see how we can run and test the app behavior when containerized.</p>
<p>Before continuing here, we recommend reading the <a href="Testing.html">basic testing guide</a>.</p>
<p>The only additional prerequisite to Ngrok and MongoDB (which we mention in the basic guide) is <a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a>. You can find a setup guide <a href="https://docs.docker.com/get-docker/">here</a>.</p>
<div class="NOTE">
<h5>Note</h5>
<p>Please note that Docker Desktop is no longer free for large businesses.</p>
</div>
<h2 id="docker-files">Docker files</h2>
<p>Each of our blueprints include a <code>Dockerfile</code>:</p>
<ul>
<li><a href="https://github.com/RWS/language-cloud-extensibility/blob/main/blueprints/dotNetAppBlueprint/Rws.LC.AppBlueprint/Dockerfile">.NET blueprint</a></li>
<li><a href="https://github.com/RWS/language-cloud-extensibility/blob/main/blueprints/javaAppBlueprint/src/main/docker/Dockerfile">Java blueprint</a></li>
</ul>
<p>The <code>Dockerfile</code> contains instructions based on which Docker will build the images. No changes should be required to these files.</p>
<h2 id="configuring-mongo">Configuring Mongo</h2>
<p>Before proceeding to run the app from a Docker container, there are a few configuration changes needed for MongoDB.</p>
<p>Because a Linux Docker container can be considered as a VM, and communicating from your container to your host machine cannot be done through localhost, you need to allow MongoDB connections on your machine IP, so that the application from your container can connect to it from an &quot;external&quot; machine.</p>
<div class="WARNING">
<h5>Warning</h5>
<p>This might open your database to access from outside your machine if your firewall is not configured correctly or installed.</p>
</div>
<p>To configure your MongoDB follow these steps:</p>
<ol>
<li>Open CLI and run this command:
<pre><code>ipconfig
</code></pre>
</li>
<li>Copy the <code>IPv4 Address</code> IP address. Note - your IP can change depending on your network settings, and you might need to update it from time to time.</li>
<li>Go to your MongoDB <code>/bin</code> location (usually 'C:/Program Files/MongoDB/Server/&lt;version&gt;/bin'), open <code>mongod.cfg</code> as Administrator and add the copied address to the <code>bindIp</code> configuration setting. For example:
<pre><code class="lang-conf">...
net:
  port: 27017
  bindIp: 127.0.0.1, &lt;copiedIPAddress&gt;
...
</code></pre>
</li>
<li>Save <code>mongod.cfg</code></li>
<li>From <strong>Task Manager</strong> navigate to the <strong>Services</strong> tab and search for 'MongoDB'. Right click and select <strong>Restart</strong>. This is needed so that the previous changes take effect.</li>
<li>Using the same IP address, edit the blueprint's Mongo configuration settings, as follows:
<ul>
<li><code>appsettings.json</code> for the .NET blueprint
<pre><code class="lang-json">{
...
  &quot;MongoDb&quot;: {
    &quot;Connection&quot;: &quot;mongodb://&lt;copiedIPAddress&gt;:27017&quot;,
    &quot;Name&quot;: &quot;lc-blueprint-app&quot;
  }
}
</code></pre>
</li>
<li><code>application.yml</code> for the Java blueprint
<pre><code class="lang-yml">...
spring:
  ...
  data:
    mongodb:
      ...
      uri: mongodb://&lt;copiedIPAddress&gt;:27017
      ...
...
</code></pre>
</li>
</ul>
</li>
</ol>
<h2 id="running-apps-in-containers">Running apps in containers</h2>
<p>There may be many ways of running applications in Docker containers. Below is a suggestion for each of our blueprints (.NET and Java).</p>
<h3 id="net-blueprint">.NET blueprint</h3>
<p>The .NET blueprint comes with Visual Studio Docker Support enabled. See <code>Rws.LC.AppBlueprint.csproj</code>:</p>
<pre><code class="lang-xml">&lt;Project Sdk=&quot;Microsoft.NET.Sdk.Web&quot;&gt;
  &lt;PropertyGroup&gt;
    ...
    &lt;DockerDefaultTargetOS&gt;Linux&lt;/DockerDefaultTargetOS&gt;
  &lt;/PropertyGroup&gt;
  ...
&lt;/Project&gt;
</code></pre>
<p>To run the solution from a container, follow these steps:</p>
<ol>
<li><p>Open <strong>Docker Desktop</strong>.</p>
</li>
<li><p>From Visual Studio, select the <strong>Docker</strong> option from the <strong>Run</strong> dropdown menu.</p>
<p><img src="https://github.com/RWS/language-cloud-public-api-doc-resources/blob/main/extensibility/testingTools/VSDocker.gif?raw=true" alt="VSDocker"></p>
</li>
<li><p>When running it for the first time, it may take a while to create the image.</p>
</li>
<li><p>Once it's done, the <strong>Containers</strong> window will open. Here you can see the details and the logs of your running containers.</p>
<p><img src="https://github.com/RWS/language-cloud-public-api-doc-resources/blob/main/extensibility/testingTools/VSContainerRun.PNG?raw=true" alt="VSContainer"></p>
</li>
<li><p>You can also check the container logs in <strong>Docker Desktop</strong>.</p>
<p><img src="https://github.com/RWS/language-cloud-public-api-doc-resources/blob/main/extensibility/testingTools/Container.gif?raw=true" alt="DockerContainer"></p>
</li>
<li><p>Check that the application is running correctly by performing a <code>GET</code> request to your descriptor endpoint. For example:</p>
<pre><code>GET http://localhost:5000/v1/descriptor
</code></pre>
</li>
</ol>
<h3 id="java-blueprint">Java blueprint</h3>
<p>For the Java blueprint, we are going to explicitly create a Docker image and run it with <strong>Docker Desktop</strong>. To achieve this, you need to:</p>
<ol>
<li><p>Run the Maven <code>package</code> command, so you generate the <code>.jar</code> file for the blueprint project.</p>
</li>
<li><p>Make sure that the <code>.jar</code> file was generated in the <code>/target</code> folder. By default, it is called <code>lc-blueprint-app-1.0-SNAPSHOT.jar</code>.</p>
</li>
<li><p>Copy the <code>.jar</code> file into the same directory with the <code>Dockerfile</code> &gt; <code>/src/main/docker</code>.</p>
</li>
<li><p>Build the Docker image by using the <a href="https://docs.docker.com/engine/reference/commandline/build/">build</a> command:</p>
<pre><code>docker build --tag &lt;image_name&gt; &lt;blueprint_location&gt;/lc-blueprint-app-public/src/main/docker
</code></pre>
</li>
<li><p>Open <strong>Docker Desktop</strong> and search for the image by the <code>&lt;image_name&gt;</code> you previously set (<strong>java_bp</strong> in this example).</p>
</li>
<li><p>Click <strong>RUN</strong> and bind the exposed ports to localhost, as follows:</p>
<p><img src="https://github.com/RWS/language-cloud-public-api-doc-resources/blob/main/extensibility/testingTools/JavaImage.gif?raw=true" alt="RunJavaImage"></p>
</li>
<li><p>Check that the application is running correctly by performing a <code>GET</code> request to your descriptor endpoint. For example:</p>
<pre><code>GET http://localhost:5000/v1/descriptor
</code></pre>
</li>
</ol>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/RWS/languagecloud-api-docs/blob/main/articles/Extensibility/docs/development/blueprints/Testing-with-Docker.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      
      <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../../../../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../../styles/main.js"></script>
  </body>
</html>